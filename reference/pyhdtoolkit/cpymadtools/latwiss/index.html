



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Latwiss - PyhDToolkit</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#009485">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:300,400,400i,700%7CFira+Code&display=fallback">
        <style>body,input{font-family:"Ubuntu Mono",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyhdtoolkitcpymadtoolslatwiss" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="PyhDToolkit" class="md-header-nav__button md-logo" aria-label="PyhDToolkit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            PyhDToolkit
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Latwiss
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/fsoubelet/PyhDToolkit/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyhDToolkit
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="PyhDToolkit" class="md-nav__button md-logo" aria-label="PyhDToolkit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PyhDToolkit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fsoubelet/PyhDToolkit/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyhDToolkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../docs/About_PyhDToolkit/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../docs/Getting_Started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" checked>
    
    <label class="md-nav__link" for="nav-4-1">
      Pyhdtoolkit
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Pyhdtoolkit" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        Pyhdtoolkit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-2" type="checkbox" id="nav-4-1-2" checked>
    
    <label class="md-nav__link" for="nav-4-1-2">
      Cpymadtools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Cpymadtools" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-2">
        <span class="md-nav__icon md-icon"></span>
        Cpymadtools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../constants/" title="Constants" class="md-nav__link">
      Constants
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../generators/" title="Generators" class="md-nav__link">
      Generators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Latwiss
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Latwiss" class="md-nav__link md-nav__link--active">
      Latwiss
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_latwiss" class="md-nav__link">
    plot_latwiss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot_machine_survey" class="md-nav__link">
    plot_machine_survey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matching/" title="Matching" class="md-nav__link">
      Matching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../orbit/" title="Orbit" class="md-nav__link">
      Orbit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../parameters/" title="Parameters" class="md-nav__link">
      Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plotters/" title="Plotters" class="md-nav__link">
      Plotters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ptc/" title="Ptc" class="md-nav__link">
      Ptc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../special/" title="Special" class="md-nav__link">
      Special
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../track/" title="Track" class="md-nav__link">
      Track
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../twiss/" title="Twiss" class="md-nav__link">
      Twiss
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-3" type="checkbox" id="nav-4-1-3">
    
    <label class="md-nav__link" for="nav-4-1-3">
      Maths
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Maths" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-3">
        <span class="md-nav__icon md-icon"></span>
        Maths
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../maths/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../maths/nonconvex_phase_sync/" title="Nonconvex Phase Sync" class="md-nav__link">
      Nonconvex Phase Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../maths/stats_fitting/" title="Stats Fitting" class="md-nav__link">
      Stats Fitting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../maths/utils/" title="Utils" class="md-nav__link">
      Utils
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-4" type="checkbox" id="nav-4-1-4">
    
    <label class="md-nav__link" for="nav-4-1-4">
      Optics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Optics" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-4">
        <span class="md-nav__icon md-icon"></span>
        Optics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../optics/beam/" title="Beam" class="md-nav__link">
      Beam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../optics/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../optics/ripken/" title="Ripken" class="md-nav__link">
      Ripken
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../optics/twiss/" title="Twiss" class="md-nav__link">
      Twiss
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-5" type="checkbox" id="nav-4-1-5">
    
    <label class="md-nav__link" for="nav-4-1-5">
      Plotting
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Plotting" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-5">
        <span class="md-nav__icon md-icon"></span>
        Plotting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../plotting/helpers/" title="Helpers" class="md-nav__link">
      Helpers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plotting/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-6" type="checkbox" id="nav-4-1-6">
    
    <label class="md-nav__link" for="nav-4-1-6">
      Tfstools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tfstools" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-6">
        <span class="md-nav__icon md-icon"></span>
        Tfstools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tfstools/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tfstools/latwiss/" title="Latwiss" class="md-nav__link">
      Latwiss
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1-7" type="checkbox" id="nav-4-1-7">
    
    <label class="md-nav__link" for="nav-4-1-7">
      Utils
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Utils" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-7">
        <span class="md-nav__icon md-icon"></span>
        Utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/cmdline/" title="Cmdline" class="md-nav__link">
      Cmdline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/contexts/" title="Contexts" class="md-nav__link">
      Contexts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/defaults/" title="Defaults" class="md-nav__link">
      Defaults
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/executors/" title="Executors" class="md-nav__link">
      Executors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/operations/" title="Operations" class="md-nav__link">
      Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/printutil/" title="Printutil" class="md-nav__link">
      Printutil
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_latwiss" class="md-nav__link">
    plot_latwiss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot_machine_survey" class="md-nav__link">
    plot_machine_survey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fsoubelet/PyhDToolkit/edit/master/reference/pyhdtoolkit/cpymadtools/latwiss.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="module-pyhdtoolkitcpymadtoolslatwiss">Module pyhdtoolkit.cpymadtools.latwiss</h1>
<p>Module cpymadtools.latwiss</p>
<hr />
<p>Created on 2019.06.15</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Module cpymadtools.latwiss</span>

<span class="sd">--------------------------</span>

<span class="sd">Created on 2019.06.15</span>

<span class="sd">:author: Felix Soubelet (felix.soubelet@cern.ch)</span>

<span class="sd">A collection of functions to elegantly plot the Twiss parameters output of a cpymad.madx.Madx</span>

<span class="sd">instance after it has ran, or machine survey.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">matplotlib.axes</span>

<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">cpymad.madx</span> <span class="kn">import</span> <span class="n">Madx</span>

<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span> <span class="nn">pyhdtoolkit.utils.defaults</span> <span class="kn">import</span> <span class="n">PLOT_PARAMS</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">PLOT_PARAMS</span><span class="p">)</span>

<span class="c1"># ----- Plotters ----- #</span>

<span class="k">def</span> <span class="nf">plot_latwiss</span><span class="p">(</span>

    <span class="n">madx</span><span class="p">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>

    <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">xoffset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="n">xlimits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">plot_dipoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">plot_quadrupoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">plot_bpms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

    <span class="n">disp_ylim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span>

    <span class="n">beta_ylim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">k0l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>

    <span class="n">k1l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>

    <span class="n">k2l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active Cpymad class after having ran a script, will create a plot representing nicely</span>

<span class="sd">    the lattice layout and the beta functions along with the horizontal dispertion function. This is very</span>

<span class="sd">    heavily refactored code, inspired by code from Guido Sterbini.</span>

<span class="sd">    WARNING: This WILL FAIL if you have not included &#39;q&#39; or &#39;Q&#39; in your quadrupoles&#39; names, and &#39;b&#39; or &#39;B&#39;</span>

<span class="sd">    in your dipoles&#39; names when defining your MAD-X sequence.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        title (str): title of your plot.</span>

<span class="sd">        figsize (Tuple[int, int]): size of the figure, defaults to (16, 10).</span>

<span class="sd">        savefig (str): will save the figure if this is not None, using the string value passed.</span>

<span class="sd">        xoffset (float): An offset applied to the S coordinate before plotting. This is useful is you want</span>

<span class="sd">            to center a plot around a specific point or element, which would then become located at s = 0.</span>

<span class="sd">            Beware this offset is applied before applying the `xlimits`. Offset defaults to 0 (no change).</span>

<span class="sd">        xlimits (Tuple[float, float]): will implement xlim (for the s coordinate) if this is</span>

<span class="sd">            not None, using the tuple passed.</span>

<span class="sd">        plot_dipoles (bool): if True, dipole patches will be plotted on the layout subplot of</span>

<span class="sd">            the figure. Defaults to True. Dipoles are plotted in blue.</span>

<span class="sd">        plot_quadrupoles (bool): if True, quadrupole patches will be plotted on the layout</span>

<span class="sd">            subplot of the figure. Defaults to True. Quadrupoles are plotted in red.</span>

<span class="sd">        plot_bpms (bool): if True, additional patches will be plotted on the layout subplot to represent</span>

<span class="sd">            Beam Position Monitors. BPMs are plotted in dark grey.</span>

<span class="sd">        disp_ylim (Tuple[float, float]): vertical axis limits for the dispersion values.</span>

<span class="sd">            Defaults to (-10, 125).</span>

<span class="sd">        beta_ylim (Tuple[float, float]): vertical axis limits for the betatron function values.</span>

<span class="sd">            Defaults to None, to be determined by matplotlib based on the provided beta values.</span>

<span class="sd">        k0l_lim (Tuple[float, float]): vertical axis limits for the k0l values used for the</span>

<span class="sd">            height of dipole patches. Defaults to (-0.25, 0.25).</span>

<span class="sd">        k1l_lim (Tuple[float, float]): vertical axis limits for the k1l values used for the</span>

<span class="sd">            height of quadrupole patches. Defaults to (-0.08, 0.08).</span>

<span class="sd">        k2l_lim (Tuple[float, float]): if given, sextupole patches will be plotted on the layout subplot of</span>

<span class="sd">            the figure, and the provided values act as vertical axis limits for the k2l values used for the</span>

<span class="sd">            height of sextupole patches.</span>

<span class="sd">    Keyword Args:</span>

<span class="sd">        Any keyword argument to be transmitted to `_plot_machine_layout`, later on to `plot_lattice_series`</span>

<span class="sd">        and then `matplotlib.patches.Rectangle`, such as lw etc.</span>

<span class="sd">    WARNING:</span>

<span class="sd">        Currently the function tries to plot legends for the different layout patches. The position of the</span>

<span class="sd">        different legends has been hardcoded in corners and might require users to tweak the axis limits</span>

<span class="sd">        (through `k0l_lim`, `k1l_lim` and `k2l_lim`) to ensure legend labels and plotted elements don&#39;t</span>

<span class="sd">        overlap.</span>

<span class="sd">    Returns:</span>

<span class="sd">         The figure on which the plots are drawn. The underlying axes can be accessed with</span>

<span class="sd">         &#39;fig.get_axes()&#39;. Eventually saves the figure as a file.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-arguments</span>

    <span class="c1"># Restrict the span of twiss_df to avoid plotting all elements then cropping when xlimits is given</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting optics functions and machine layout&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting Twiss dataframe from cpymad&quot;</span><span class="p">)</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">twiss</span><span class="o">.</span><span class="n">dframe</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span> <span class="o">-</span> <span class="n">xoffset</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">if</span> <span class="n">xlimits</span> <span class="k">else</span> <span class="n">twiss_df</span>

    <span class="c1"># Create a subplot for the lattice patches (takes a third of figure)</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">_plot_machine_layout</span><span class="p">(</span>

        <span class="n">madx</span><span class="p">,</span>

        <span class="n">quadrupole_patches_axis</span><span class="o">=</span><span class="n">quadrupole_patches_axis</span><span class="p">,</span>

        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>

        <span class="n">xoffset</span><span class="o">=</span><span class="n">xoffset</span><span class="p">,</span>

        <span class="n">xlimits</span><span class="o">=</span><span class="n">xlimits</span><span class="p">,</span>

        <span class="n">plot_dipoles</span><span class="o">=</span><span class="n">plot_dipoles</span><span class="p">,</span>

        <span class="n">plot_quadrupoles</span><span class="o">=</span><span class="n">plot_quadrupoles</span><span class="p">,</span>

        <span class="n">plot_bpms</span><span class="o">=</span><span class="n">plot_bpms</span><span class="p">,</span>

        <span class="n">k0l_lim</span><span class="o">=</span><span class="n">k0l_lim</span><span class="p">,</span>

        <span class="n">k1l_lim</span><span class="o">=</span><span class="n">k1l_lim</span><span class="p">,</span>

        <span class="n">k2l_lim</span><span class="o">=</span><span class="n">k2l_lim</span><span class="p">,</span>

        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

    <span class="p">)</span>

    <span class="c1"># Plotting beta functions on remaining two thirds of the figure</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting up betatron functions subplot&quot;</span><span class="p">)</span>

    <span class="n">betatron_axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">quadrupole_patches_axis</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">betx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta_x$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">bety</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta_y$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta$-functions [m]&quot;</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;s [m]&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Setting up dispersion functions subplot&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span> <span class="o">=</span> <span class="n">betatron_axis</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$D_x$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;sienna&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$D_y$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dispersions [m]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">beta_ylim</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting ylim for betatron functions plot&quot;</span><span class="p">)</span>

        <span class="n">betatron_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">beta_ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">disp_ylim</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting ylim for dispersion plot&quot;</span><span class="p">)</span>

        <span class="n">dispertion_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">disp_ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlimits</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting xlim for longitudinal coordinate&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving latwiss plot as </span><span class="si">{</span><span class="n">savefig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="k">def</span> <span class="nf">plot_machine_survey</span><span class="p">(</span>

    <span class="n">madx</span><span class="p">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Machine Layout&quot;</span><span class="p">,</span>

    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>

    <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">show_elements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

    <span class="n">high_orders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active Cpymad class after having ran a script, will create a plot</span>

<span class="sd">    representing the machine geometry in 2D. Original code is from Guido Sterbini.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        title (str): title of your plot.</span>

<span class="sd">        figsize (Tuple[int, int]): size of the figure, defaults to (16, 10).</span>

<span class="sd">        savefig (str): will save the figure if this is not None, using the string value passed.</span>

<span class="sd">        show_elements (bool): if True, will try to plot by differentiating elements.</span>

<span class="sd">            Experimental, defaults to False.</span>

<span class="sd">        high_orders (bool): if True, plot sextupoles and octupoles when show_elements is True,</span>

<span class="sd">            otherwise only up to quadrupoles. Defaults to False.</span>

<span class="sd">    Returns:</span>

<span class="sd">         The figure on which the plots are drawn. The underlying axes can be accessed with</span>

<span class="sd">         &#39;fig.get_axes()&#39;. Eventually saves the figure as a file.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting machine survey from cpymad&quot;</span><span class="p">)</span>

    <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">survey</span><span class="p">()</span>

    <span class="n">survey</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">survey</span><span class="o">.</span><span class="n">dframe</span><span class="p">()</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_elements</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting survey with elements differentiation&quot;</span><span class="p">)</span>

        <span class="n">element_dfs</span> <span class="o">=</span> <span class="n">_make_survey_groups</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>

            <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;dipoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>

            <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;dipoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>

            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>

            <span class="n">c</span><span class="o">=</span><span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;dipoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>

            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;copper&quot;</span><span class="p">,</span>

            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dipoles&quot;</span><span class="p">,</span>

        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>

            <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;quad_foc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;quad_foc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;QF&quot;</span><span class="p">,</span>

        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>

            <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;quad_defoc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;quad_defoc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;QD&quot;</span><span class="p">,</span>

        <span class="p">)</span>

        <span class="k">if</span> <span class="n">high_orders</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting high order magnetic elements (up to octupoles)&quot;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>

                <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;sextupoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;sextupoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span>

            <span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>

                <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;octupoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">element_dfs</span><span class="p">[</span><span class="s2">&quot;octupoles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO&quot;</span><span class="p">,</span>

            <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting survey without elements differentiation&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">survey</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">survey</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">survey</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;s [m]&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;z [m]&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;x [m]&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving machine survey plot as </span><span class="si">{</span><span class="n">savefig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="c1"># ----- Utility plotters ----- #</span>

<span class="k">def</span> <span class="nf">_plot_lattice_series</span><span class="p">(</span>

    <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>

    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>

    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>

    <span class="n">v_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>

    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>

    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>

    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Plots the layout of your machine as a patch of rectangles for different element types.</span>

<span class="sd">    Original code from Guido Sterbini.</span>

<span class="sd">    Args:</span>

<span class="sd">        ax (matplotlib.axes.Axes): an existing  matplotlib.axis `Axes` object to act on.</span>

<span class="sd">        series (pd.DataFrame): a dataframe with your elements&#39; data.</span>

<span class="sd">        height (float): value to reach for the patch on the y axis.</span>

<span class="sd">        v_offset (float): vertical offset for the patch.</span>

<span class="sd">        color (str): color kwarg to transmit to pyplot.</span>

<span class="sd">        alpha (float): alpha kwarg to transmit to pyplot.</span>

<span class="sd">    Keyword Args:</span>

<span class="sd">        Any kwarg that can be given to matplotlib.patches.Rectangle(), for instance `lw` for the edge line</span>

<span class="sd">        width.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>

        <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>

            <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">s</span> <span class="o">-</span> <span class="n">series</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">v_offset</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># anchor point</span>

            <span class="n">series</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>  <span class="c1"># width</span>

            <span class="n">height</span><span class="p">,</span>  <span class="c1"># height</span>

            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>

            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>

            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

        <span class="p">)</span>

    <span class="p">)</span>

<span class="k">def</span> <span class="nf">_plot_machine_layout</span><span class="p">(</span>

    <span class="n">madx</span><span class="p">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">quadrupole_patches_axis</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

    <span class="n">xoffset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="n">xlimits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">plot_dipoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">plot_quadrupoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">plot_bpms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

    <span class="n">k0l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>

    <span class="n">k1l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>

    <span class="n">k2l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active Cpymad class after having ran a script, will plot the lattice layout and the</span>

<span class="sd">    on a given axis. This is the function that takes care of the machine layout in `plot_latwiss`, and</span>

<span class="sd">    is in theory a private function, though if you know what you are doing you may use it individually.</span>

<span class="sd">    WARNING: This WILL FAIL if you have not included &#39;q&#39; or &#39;Q&#39; in your quadrupoles&#39; names, and &#39;b&#39; or &#39;B&#39;</span>

<span class="sd">    in your dipoles&#39; names when defining your MAD-X sequence.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        quadrupole_patches_axis (matplotlib.axes.Axes): the axis on which to plot. Will also create the</span>

<span class="sd">            appropriate new axes with `twinx()` to plot the element orders asked for.</span>

<span class="sd">        title (str): title of your plot.</span>

<span class="sd">        xoffset (float): An offset applied to the S coordinate before plotting. This is useful is you want</span>

<span class="sd">            to center a plot around a specific point or element, which would then become located at s = 0.</span>

<span class="sd">            Beware this offset is applied before applying the `xlimits`. Offset defaults to 0 (no change).</span>

<span class="sd">        xlimits (Tuple[float, float]): will implement xlim (for the s coordinate) if this is</span>

<span class="sd">            not None, using the tuple passed.</span>

<span class="sd">        plot_dipoles (bool): if True, dipole patches will be plotted on the layout subplot of</span>

<span class="sd">            the figure. Defaults to True. Dipoles are plotted in blue.</span>

<span class="sd">        plot_quadrupoles (bool): if True, quadrupole patches will be plotted on the layout</span>

<span class="sd">            subplot of the figure. Defaults to True. Quadrupoles are plotted in red.</span>

<span class="sd">        plot_bpms (bool): if True, additional patches will be plotted on the layout subplot to represent</span>

<span class="sd">            Beam Position Monitors. BPMs are plotted in dark grey.</span>

<span class="sd">        k0l_lim (Tuple[float, float]): vertical axis limits for the k0l values used for the</span>

<span class="sd">            height of dipole patches. Defaults to (-0.25, 0.25).</span>

<span class="sd">        k1l_lim (Tuple[float, float]): vertical axis limits for the k1l values used for the</span>

<span class="sd">            height of quadrupole patches. Defaults to (-0.08, 0.08).</span>

<span class="sd">        k2l_lim (Tuple[float, float]): if given, sextupole patches will be plotted on the layout subplot of</span>

<span class="sd">            the figure, and the provided values act as vertical axis limits for the k2l values used for the</span>

<span class="sd">            height of sextupole patches.</span>

<span class="sd">    Keyword Args:</span>

<span class="sd">        Any keyword argument to be transmitted to `_plot_lattice_series`, and later on to</span>

<span class="sd">        `matplotlib.patches.Rectangle`, such as lw etc.</span>

<span class="sd">    WARNING:</span>

<span class="sd">        Currently the function tries to plot legends for the different layout patches. The position of the</span>

<span class="sd">        different legends has been hardcoded in corners and might require users to tweak the axis limits</span>

<span class="sd">        (through `k0l_lim`, `k1l_lim` and `k2l_lim`) to ensure legend labels and plotted elements don&#39;t</span>

<span class="sd">        overlap.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-arguments</span>

    <span class="c1"># Restrict the span of twiss_df to avoid plotting all elements then cropping when xlimits is given</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Getting Twiss dataframe from cpymad&quot;</span><span class="p">)</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">twiss</span><span class="o">.</span><span class="n">dframe</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span> <span class="o">-</span> <span class="n">xoffset</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">if</span> <span class="n">xlimits</span> <span class="k">else</span> <span class="n">twiss_df</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting machine layout&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting from axis &#39;</span><span class="si">{</span><span class="n">quadrupole_patches_axis</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;1/f=K1L [m$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>  <span class="c1"># quadrupole in red</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">k1l_lim</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">twiss_df</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># 0-level line</span>

    <span class="n">dipole_patches_axis</span> <span class="o">=</span> <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

    <span class="n">dipole_patches_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta$=K0L [rad]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">)</span>  <span class="c1"># dipoles in blue</span>

    <span class="n">dipole_patches_axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">)</span>

    <span class="n">dipole_patches_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">k0l_lim</span><span class="p">)</span>

    <span class="n">dipole_patches_axis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># All elements can be defined as a &#39;multipole&#39;, but dipoles can also be defined as &#39;rbend&#39; or &#39;sbend&#39;,</span>

    <span class="c1"># quadrupoles as &#39;quadrupoles&#39; and sextupoles as &#39;sextupoles&#39;. Function does not handle higher orders.</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Extracting element-specific dataframes&quot;</span><span class="p">)</span>

    <span class="n">dipoles_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[</span>

        <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;rbend&quot;</span><span class="p">,</span> <span class="s2">&quot;sbend&quot;</span><span class="p">]))</span>

        <span class="o">&amp;</span> <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="p">]</span>

    <span class="n">quadrupoles_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[</span>

        <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;quadrupole&quot;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="p">]</span>

    <span class="n">sextupoles_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[</span>

        <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;sextupole&quot;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="p">]</span>

    <span class="n">bpms_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">[(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;monitor&quot;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">twiss_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;BPM&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">plot_dipoles</span><span class="p">:</span>  <span class="c1"># beware &#39;sbend&#39; and &#39;rbend&#39; have an &#39;angle&#39; value and not a &#39;k0l&#39;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting dipole patches&quot;</span><span class="p">)</span>

        <span class="n">plotted_elements</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># will help us not declare a label for legend at every patch</span>

        <span class="k">for</span> <span class="n">dipole_name</span><span class="p">,</span> <span class="n">dipole</span> <span class="ow">in</span> <span class="n">dipoles_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  <span class="c1"># by default twiss.dframe() has names as index</span>

            <span class="k">if</span> <span class="n">dipole</span><span class="o">.</span><span class="n">k0l</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dipole</span><span class="o">.</span><span class="n">angle</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting dipole element &#39;</span><span class="si">{</span><span class="n">dipole_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="n">_plot_lattice_series</span><span class="p">(</span>

                    <span class="n">dipole_patches_axis</span><span class="p">,</span>

                    <span class="n">dipole</span><span class="p">,</span>

                    <span class="n">height</span><span class="o">=</span><span class="n">dipole</span><span class="o">.</span><span class="n">k0l</span> <span class="k">if</span> <span class="n">dipole</span><span class="o">.</span><span class="n">k0l</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">dipole</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span>

                    <span class="n">v_offset</span><span class="o">=</span><span class="n">dipole</span><span class="o">.</span><span class="n">k0l</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">dipole</span><span class="o">.</span><span class="n">k0l</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">dipole</span><span class="o">.</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>

                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span>

                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MB&quot;</span> <span class="k">if</span> <span class="n">plotted_elements</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>

                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

                <span class="p">)</span>

                <span class="n">plotted_elements</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">dipole_patches_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_quadrupoles</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting quadrupole patches&quot;</span><span class="p">)</span>

        <span class="n">plotted_elements</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">quadrupole_name</span><span class="p">,</span> <span class="n">quadrupole</span> <span class="ow">in</span> <span class="n">quadrupoles_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting quadrupole element &#39;</span><span class="si">{</span><span class="n">quadrupole_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">_plot_lattice_series</span><span class="p">(</span>

                <span class="n">quadrupole_patches_axis</span><span class="p">,</span>

                <span class="n">quadrupole</span><span class="p">,</span>

                <span class="n">height</span><span class="o">=</span><span class="n">quadrupole</span><span class="o">.</span><span class="n">k1l</span><span class="p">,</span>

                <span class="n">v_offset</span><span class="o">=</span><span class="n">quadrupole</span><span class="o">.</span><span class="n">k1l</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>

                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>

                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MQ&quot;</span> <span class="k">if</span> <span class="n">plotted_elements</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>

                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

            <span class="p">)</span>

            <span class="n">plotted_elements</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k2l_lim</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting sextupole patches&quot;</span><span class="p">)</span>

        <span class="n">sextupoles_patches_axis</span> <span class="o">=</span> <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="n">sextupoles_patches_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;K2L [m$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">)</span>

        <span class="n">sextupoles_patches_axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">)</span>

        <span class="n">sextupoles_patches_axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>

        <span class="n">sextupoles_patches_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">k2l_lim</span><span class="p">)</span>

        <span class="n">plotted_elements</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">sextupole_name</span><span class="p">,</span> <span class="n">sextupole</span> <span class="ow">in</span> <span class="n">sextupoles_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting sextupole element &#39;</span><span class="si">{</span><span class="n">sextupole_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">_plot_lattice_series</span><span class="p">(</span>

                <span class="n">sextupoles_patches_axis</span><span class="p">,</span>

                <span class="n">sextupole</span><span class="p">,</span>

                <span class="n">height</span><span class="o">=</span><span class="n">sextupole</span><span class="o">.</span><span class="n">k2l</span><span class="p">,</span>

                <span class="n">v_offset</span><span class="o">=</span><span class="n">sextupole</span><span class="o">.</span><span class="n">k2l</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>

                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;goldenrod&quot;</span><span class="p">,</span>

                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span> <span class="k">if</span> <span class="n">plotted_elements</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>

                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

            <span class="p">)</span>

            <span class="n">plotted_elements</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">sextupoles_patches_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_bpms</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting BPM patches&quot;</span><span class="p">)</span>

        <span class="n">bpm_patches_axis</span> <span class="o">=</span> <span class="n">quadrupole_patches_axis</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="n">bpm_patches_axis</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>  <span class="c1"># hide yticks, labels etc</span>

        <span class="n">bpm_patches_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>

        <span class="n">plotted_elements</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">bpm_name</span><span class="p">,</span> <span class="n">bpm</span> <span class="ow">in</span> <span class="n">bpms_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting BPM element &#39;</span><span class="si">{</span><span class="n">bpm_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">_plot_lattice_series</span><span class="p">(</span>

                <span class="n">bpm_patches_axis</span><span class="p">,</span>

                <span class="n">bpm</span><span class="p">,</span>

                <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>

                <span class="n">v_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>

                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dimgrey&quot;</span><span class="p">,</span>

                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BPM&quot;</span> <span class="k">if</span> <span class="n">plotted_elements</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>

                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

            <span class="p">)</span>

            <span class="n">plotted_elements</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">bpm_patches_axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># ----- Helpers ----- #</span>

<span class="k">def</span> <span class="nf">_make_survey_groups</span><span class="p">(</span><span class="n">survey_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Gets a survey dataframe and returns different sub-dataframes corresponding to different</span>

<span class="sd">    magnetic elements.</span>

<span class="sd">    Args:</span>

<span class="sd">        survey_df (pd.DataFrame): machine survey dataframe obtained from your Madx instance, with</span>

<span class="sd">            &lt;instance&gt;.table.survey.dframe().</span>

<span class="sd">    Returns:</span>

<span class="sd">        A dictionary containing a dataframe for dipoles, focusing quadrupoles, defocusing</span>

<span class="sd">        quadrupoles, sextupoles and octupoles. The keys are self-explanatory.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting different element groups dframes from MAD-X survey&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>

        <span class="s2">&quot;dipoles&quot;</span><span class="p">:</span> <span class="n">survey_df</span><span class="p">[</span>

            <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;sbend&quot;</span><span class="p">,</span> <span class="s2">&quot;rbend&quot;</span><span class="p">]))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="p">],</span>

        <span class="s2">&quot;quad_foc&quot;</span><span class="p">:</span> <span class="n">survey_df</span><span class="p">[</span>

            <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;quadrupole&quot;</span><span class="p">]))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="p">],</span>

        <span class="s2">&quot;quad_defoc&quot;</span><span class="p">:</span> <span class="n">survey_df</span><span class="p">[</span>

            <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;quadrupole&quot;</span><span class="p">]))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="p">],</span>

        <span class="s2">&quot;sextupoles&quot;</span><span class="p">:</span> <span class="n">survey_df</span><span class="p">[</span>

            <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;sextupole&quot;</span><span class="p">]))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="p">],</span>

        <span class="s2">&quot;octupoles&quot;</span><span class="p">:</span> <span class="n">survey_df</span><span class="p">[</span>

            <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;multipole&quot;</span><span class="p">,</span> <span class="s2">&quot;octupole&quot;</span><span class="p">]))</span>

            <span class="o">&amp;</span> <span class="p">(</span><span class="n">survey_df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="p">],</span>

    <span class="p">}</span>
</code></pre></div>

</details>
<h2 id="variables">Variables</h2>
<div class="highlight"><pre><span></span><code><span class="n">PLOT_PARAMS</span>
</code></pre></div>
<h2 id="functions">Functions</h2>
<h3 id="plot_latwiss">plot_latwiss</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_latwiss</span><span class="p">(</span>
    <span class="n">madx</span><span class="p">:</span> <span class="n">cpymad</span><span class="o">.</span><span class="n">madx</span><span class="o">.</span><span class="n">Madx</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xoffset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">xlimits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_dipoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_quadrupoles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_bpms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">disp_ylim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span>
    <span class="n">beta_ylim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">k0l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="n">k1l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
    <span class="n">k2l_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span>
</code></pre></div>
<p>Provided with an active Cpymad class after having ran a script, will create a plot representing nicely
the lattice layout and the beta functions along with the horizontal dispertion function. This is very
heavily refactored code, inspired by code from Guido Sterbini.</p>
<p>WARNING: This WILL FAIL if you have not included 'q' or 'Q' in your quadrupoles' names, and 'b' or 'B'
in your dipoles' names when defining your MAD-X sequence.</p>
<p>Args:
    madx (cpymad.madx.Madx): an instanciated cpymad Madx object.
    title (str): title of your plot.
    figsize (Tuple[int, int]): size of the figure, defaults to (16, 10).
    savefig (str): will save the figure if this is not None, using the string value passed.
    xoffset (float): An offset applied to the S coordinate before plotting. This is useful is you want
        to center a plot around a specific point or element, which would then become located at s = 0.
        Beware this offset is applied before applying the <code>xlimits</code>. Offset defaults to 0 (no change).
    xlimits (Tuple[float, float]): will implement xlim (for the s coordinate) if this is
        not None, using the tuple passed.
    plot_dipoles (bool): if True, dipole patches will be plotted on the layout subplot of
        the figure. Defaults to True. Dipoles are plotted in blue.
    plot_quadrupoles (bool): if True, quadrupole patches will be plotted on the layout
        subplot of the figure. Defaults to True. Quadrupoles are plotted in red.
    plot_bpms (bool): if True, additional patches will be plotted on the layout subplot to represent
        Beam Position Monitors. BPMs are plotted in dark grey.
    disp_ylim (Tuple[float, float]): vertical axis limits for the dispersion values.
        Defaults to (-10, 125).
    beta_ylim (Tuple[float, float]): vertical axis limits for the betatron function values.
        Defaults to None, to be determined by matplotlib based on the provided beta values.
    k0l_lim (Tuple[float, float]): vertical axis limits for the k0l values used for the
        height of dipole patches. Defaults to (-0.25, 0.25).
    k1l_lim (Tuple[float, float]): vertical axis limits for the k1l values used for the
        height of quadrupole patches. Defaults to (-0.08, 0.08).
    k2l_lim (Tuple[float, float]): if given, sextupole patches will be plotted on the layout subplot of
        the figure, and the provided values act as vertical axis limits for the k2l values used for the
        height of sextupole patches.</p>
<p>Keyword Args:
    Any keyword argument to be transmitted to <code>_plot_machine_layout</code>, later on to <code>plot_lattice_series</code>
    and then <code>matplotlib.patches.Rectangle</code>, such as lw etc.</p>
<p>WARNING:
    Currently the function tries to plot legends for the different layout patches. The position of the
    different legends has been hardcoded in corners and might require users to tweak the axis limits
    (through <code>k0l_lim</code>, <code>k1l_lim</code> and <code>k2l_lim</code>) to ensure legend labels and plotted elements don't
    overlap.</p>
<p>Returns:
     The figure on which the plots are drawn. The underlying axes can be accessed with
     'fig.get_axes()'. Eventually saves the figure as a file.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">plot_latwiss</span><span class="p">(</span>

    <span class="n">madx</span><span class="o">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">title</span><span class="o">:</span> <span class="n">str</span><span class="p">,</span>

    <span class="n">figsize</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="err">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>

    <span class="n">savefig</span><span class="o">:</span> <span class="n">str</span> <span class="o">=</span> <span class="k">None</span><span class="p">,</span>

    <span class="n">xoffset</span><span class="o">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="n">xlimits</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="k">None</span><span class="p">,</span>

    <span class="n">plot_dipoles</span><span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="no">True</span><span class="p">,</span>

    <span class="n">plot_quadrupoles</span><span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="no">True</span><span class="p">,</span>

    <span class="n">plot_bpms</span><span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="no">False</span><span class="p">,</span>

    <span class="n">disp_ylim</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span>

    <span class="n">beta_ylim</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="k">None</span><span class="p">,</span>

    <span class="n">k0l_lim</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>

    <span class="n">k1l_lim</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>

    <span class="n">k2l_lim</span><span class="o">:</span> <span class="n">Tuple</span><span class="err">[</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="err">]</span> <span class="o">=</span> <span class="k">None</span><span class="p">,</span>

    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="p">.</span><span class="n">figure</span><span class="p">.</span><span class="n">Figure</span><span class="o">:</span>

    <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2"></span>

<span class="s2">    Provided with an active Cpymad class after having ran a script, will create a plot representing nicely</span>

<span class="s2">    the lattice layout and the beta functions along with the horizontal dispertion function. This is very</span>

<span class="s2">    heavily refactored code, inspired by code from Guido Sterbini.</span>

<span class="s2">    WARNING: This WILL FAIL if you have not included &#39;q&#39; or &#39;Q&#39; in your quadrupoles&#39; names, and &#39;b&#39; or &#39;B&#39;</span>

<span class="s2">    in your dipoles&#39; names when defining your MAD-X sequence.</span>

<span class="s2">    Args:</span>

<span class="s2">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="s2">        title (str): title of your plot.</span>

<span class="s2">        figsize (Tuple[int, int]): size of the figure, defaults to (16, 10).</span>

<span class="s2">        savefig (str): will save the figure if this is not None, using the string value passed.</span>

<span class="s2">        xoffset (float): An offset applied to the S coordinate before plotting. This is useful is you want</span>

<span class="s2">            to center a plot around a specific point or element, which would then become located at s = 0.</span>

<span class="s2">            Beware this offset is applied before applying the `xlimits`. Offset defaults to 0 (no change).</span>

<span class="s2">        xlimits (Tuple[float, float]): will implement xlim (for the s coordinate) if this is</span>

<span class="s2">            not None, using the tuple passed.</span>

<span class="s2">        plot_dipoles (bool): if True, dipole patches will be plotted on the layout subplot of</span>

<span class="s2">            the figure. Defaults to True. Dipoles are plotted in blue.</span>

<span class="s2">        plot_quadrupoles (bool): if True, quadrupole patches will be plotted on the layout</span>

<span class="s2">            subplot of the figure. Defaults to True. Quadrupoles are plotted in red.</span>

<span class="s2">        plot_bpms (bool): if True, additional patches will be plotted on the layout subplot to represent</span>

<span class="s2">            Beam Position Monitors. BPMs are plotted in dark grey.</span>

<span class="s2">        disp_ylim (Tuple[float, float]): vertical axis limits for the dispersion values.</span>

<span class="s2">            Defaults to (-10, 125).</span>

<span class="s2">        beta_ylim (Tuple[float, float]): vertical axis limits for the betatron function values.</span>

<span class="s2">            Defaults to None, to be determined by matplotlib based on the provided beta values.</span>

<span class="s2">        k0l_lim (Tuple[float, float]): vertical axis limits for the k0l values used for the</span>

<span class="s2">            height of dipole patches. Defaults to (-0.25, 0.25).</span>

<span class="s2">        k1l_lim (Tuple[float, float]): vertical axis limits for the k1l values used for the</span>

<span class="s2">            height of quadrupole patches. Defaults to (-0.08, 0.08).</span>

<span class="s2">        k2l_lim (Tuple[float, float]): if given, sextupole patches will be plotted on the layout subplot of</span>

<span class="s2">            the figure, and the provided values act as vertical axis limits for the k2l values used for the</span>

<span class="s2">            height of sextupole patches.</span>

<span class="s2">    Keyword Args:</span>

<span class="s2">        Any keyword argument to be transmitted to `_plot_machine_layout`, later on to `plot_lattice_series`</span>

<span class="s2">        and then `matplotlib.patches.Rectangle`, such as lw etc.</span>

<span class="s2">    WARNING:</span>

<span class="s2">        Currently the function tries to plot legends for the different layout patches. The position of the</span>

<span class="s2">        different legends has been hardcoded in corners and might require users to tweak the axis limits</span>

<span class="s2">        (through `k0l_lim`, `k1l_lim` and `k2l_lim`) to ensure legend labels and plotted elements don&#39;t</span>

<span class="s2">        overlap.</span>

<span class="s2">    Returns:</span>

<span class="s2">         The figure on which the plots are drawn. The underlying axes can be accessed with</span>

<span class="s2">         &#39;fig.get_axes()&#39;. Eventually saves the figure as a file.</span>

<span class="s2">    </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

    <span class="c1"># pylint: disable=too-many-arguments</span>

    <span class="c1"># Restrict the span of twiss_df to avoid plotting all elements then cropping when xlimits is given</span>

    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting optics functions and machine layout&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting Twiss dataframe from cpymad&quot;</span><span class="p">)</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">madx</span><span class="p">.</span><span class="k">table</span><span class="p">.</span><span class="n">twiss</span><span class="p">.</span><span class="n">dframe</span><span class="p">().</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span> <span class="o">-</span> <span class="n">xoffset</span>

    <span class="n">twiss_df</span> <span class="o">=</span> <span class="n">twiss_df</span><span class="err">[</span><span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="k">between</span><span class="p">(</span><span class="n">xlimits</span><span class="err">[</span><span class="mi">0</span><span class="err">]</span><span class="p">,</span> <span class="n">xlimits</span><span class="err">[</span><span class="mi">1</span><span class="err">]</span><span class="p">)</span><span class="err">]</span> <span class="k">if</span> <span class="n">xlimits</span> <span class="k">else</span> <span class="n">twiss_df</span>

    <span class="c1"># Create a subplot for the lattice patches (takes a third of figure)</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">quadrupole_patches_axis</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">_plot_machine_layout</span><span class="p">(</span>

        <span class="n">madx</span><span class="p">,</span>

        <span class="n">quadrupole_patches_axis</span><span class="o">=</span><span class="n">quadrupole_patches_axis</span><span class="p">,</span>

        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>

        <span class="n">xoffset</span><span class="o">=</span><span class="n">xoffset</span><span class="p">,</span>

        <span class="n">xlimits</span><span class="o">=</span><span class="n">xlimits</span><span class="p">,</span>

        <span class="n">plot_dipoles</span><span class="o">=</span><span class="n">plot_dipoles</span><span class="p">,</span>

        <span class="n">plot_quadrupoles</span><span class="o">=</span><span class="n">plot_quadrupoles</span><span class="p">,</span>

        <span class="n">plot_bpms</span><span class="o">=</span><span class="n">plot_bpms</span><span class="p">,</span>

        <span class="n">k0l_lim</span><span class="o">=</span><span class="n">k0l_lim</span><span class="p">,</span>

        <span class="n">k1l_lim</span><span class="o">=</span><span class="n">k1l_lim</span><span class="p">,</span>

        <span class="n">k2l_lim</span><span class="o">=</span><span class="n">k2l_lim</span><span class="p">,</span>

        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>

    <span class="p">)</span>

    <span class="c1"># Plotting beta functions on remaining two thirds of the figure</span>

    <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting up betatron functions subplot&quot;</span><span class="p">)</span>

    <span class="n">betatron_axis</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">quadrupole_patches_axis</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="p">.</span><span class="n">betx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta_x$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="p">.</span><span class="n">bety</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta_y$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="p">.</span><span class="k">set</span><span class="n">_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">beta$-functions [m]&quot;</span><span class="p">)</span>

    <span class="n">betatron_axis</span><span class="p">.</span><span class="k">set</span><span class="n">_xlabel</span><span class="p">(</span><span class="s2">&quot;s [m]&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Setting up dispersion functions subplot&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span> <span class="o">=</span> <span class="n">betatron_axis</span><span class="p">.</span><span class="n">twinx</span><span class="p">()</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="p">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$D_x$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twiss_df</span><span class="p">.</span><span class="n">s</span><span class="p">,</span> <span class="n">twiss_df</span><span class="p">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;sienna&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$D_y$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="k">set</span><span class="n">_ylabel</span><span class="p">(</span><span class="s2">&quot;Dispersions [m]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">)</span>

    <span class="n">dispertion_axis</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="no">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">beta_ylim</span><span class="o">:</span>

        <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting ylim for betatron functions plot&quot;</span><span class="p">)</span>

        <span class="n">betatron_axis</span><span class="p">.</span><span class="k">set</span><span class="n">_ylim</span><span class="p">(</span><span class="n">beta_ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">disp_ylim</span><span class="o">:</span>

        <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting ylim for dispersion plot&quot;</span><span class="p">)</span>

        <span class="n">dispertion_axis</span><span class="p">.</span><span class="k">set</span><span class="n">_ylim</span><span class="p">(</span><span class="n">disp_ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlimits</span><span class="o">:</span>

        <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting xlim for longitudinal coordinate&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="o">:</span>

        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Saving latwiss plot as {savefig}&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figure</span>
</code></pre></div>

</details>
<h3 id="plot_machine_survey">plot_machine_survey</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_machine_survey</span><span class="p">(</span>
    <span class="n">madx</span><span class="p">:</span> <span class="n">cpymad</span><span class="o">.</span><span class="n">madx</span><span class="o">.</span><span class="n">Madx</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Machine Layout&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_elements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">high_orders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span>
</code></pre></div>
<p>Provided with an active Cpymad class after having ran a script, will create a plot</p>
<p>representing the machine geometry in 2D. Original code is from Guido Sterbini.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>madx</td>
<td>cpymad.madx.Madx</td>
<td>an instanciated cpymad Madx object.</td>
<td>None</td>
</tr>
<tr>
<td>title</td>
<td>str</td>
<td>title of your plot.</td>
<td>None</td>
</tr>
<tr>
<td>figsize</td>
<td>Tuple[int, int]</td>
<td>size of the figure, defaults to (16, 10).</td>
<td>None</td>
</tr>
<tr>
<td>savefig</td>
<td>str</td>
<td>will save the figure if this is not None, using the string value passed.</td>
<td>None</td>
</tr>
<tr>
<td>show_elements</td>
<td>bool</td>
<td>if True, will try to plot by differentiating elements.</td>
<td></td>
</tr>
<tr>
<td>Experimental, defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>high_orders</td>
<td>bool</td>
<td>if True, plot sextupoles and octupoles when show_elements is True,</td>
<td></td>
</tr>
<tr>
<td>otherwise only up to quadrupoles. Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>The figure on which the plots are drawn. The underlying axes can be accessed with</td>
</tr>
<tr>
<td>'fig.get_axes()'. Eventually saves the figure as a file.</td>
<td></td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">plot_machine_survey</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="nl">madx</span><span class="p">:</span><span class="w"> </span><span class="n">Madx</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="nl">title</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Machine Layout&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="nl">figsize</span><span class="p">:</span><span class="w"> </span><span class="n">Tuple</span><span class="o">[</span><span class="n">int, int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="nl">savefig</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="nl">show_elements</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="nl">high_orders</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"></span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">matplotlib</span><span class="p">.</span><span class="n">figure</span><span class="p">.</span><span class="nl">Figure</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    Provided with an active Cpymad class after having ran a script, will create a plot</span>

<span class="ss">    representing the machine geometry in 2D. Original code is from Guido Sterbini.</span>

<span class="ss">    Args:</span>

<span class="ss">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="ss">        title (str): title of your plot.</span>

<span class="ss">        figsize (Tuple[int, int]): size of the figure, defaults to (16, 10).</span>

<span class="ss">        savefig (str): will save the figure if this is not None, using the string value passed.</span>

<span class="ss">        show_elements (bool): if True, will try to plot by differentiating elements.</span>

<span class="ss">            Experimental, defaults to False.</span>

<span class="ss">        high_orders (bool): if True, plot sextupoles and octupoles when show_elements is True,</span>

<span class="ss">            otherwise only up to quadrupoles. Defaults to False.</span>

<span class="ss">    Returns:</span>

<span class="ss">         The figure on which the plots are drawn. The underlying axes can be accessed with</span>

<span class="ss">         &#39;fig.get_axes()&#39;. Eventually saves the figure as a file.</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Getting machine survey from cpymad&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">survey</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">survey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">madx</span><span class="p">.</span><span class="nc">table</span><span class="p">.</span><span class="n">survey</span><span class="p">.</span><span class="n">dframe</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">figure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">show_elements</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Plotting survey with elements differentiation&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">element_dfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_make_survey_groups</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;dipoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;dipoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">marker</span><span class="o">=</span><span class="ss">&quot;.&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">c</span><span class="o">=</span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;dipoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">s</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">cmap</span><span class="o">=</span><span class="ss">&quot;copper&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;Dipoles&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;quad_foc&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;quad_foc&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;QF&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;quad_defoc&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;quad_defoc&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;QD&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">high_orders</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Plotting high order magnetic elements (up to octupoles)&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;sextupoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;sextupoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">&quot;m&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;MS&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;octupoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">element_dfs</span><span class="o">[</span><span class="n">&quot;octupoles&quot;</span><span class="o">]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">&quot;cyan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;MO&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Plotting survey without elements differentiation&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">survey</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">survey</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">survey</span><span class="p">.</span><span class="n">s</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="ss">&quot;equal&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">().</span><span class="n">set_label</span><span class="p">(</span><span class="ss">&quot;s [m]&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="ss">&quot;z [m]&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="ss">&quot;x [m]&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">savefig</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Saving machine survey plot as {savefig}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">,</span><span class="w"> </span><span class="nf">format</span><span class="o">=</span><span class="ss">&quot;pdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">figure</span><span class="w"></span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Index
              </span>
            </div>
          </a>
        
        
          <a href="../matching/" title="Matching" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Matching
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>