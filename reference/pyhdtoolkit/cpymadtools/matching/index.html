
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.0">
    
    
      
        <title>Matching - PyhDToolkit</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:300,400,400i,700%7CFira+Code&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu Mono";--md-code-font-family:"Fira Code"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyhdtoolkitcpymadtoolsmatching" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="PyhDToolkit" class="md-header__button md-logo" aria-label="PyhDToolkit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyhDToolkit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Matching
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/fsoubelet/PyhDToolkit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyhDToolkit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="PyhDToolkit" class="md-nav__button md-logo" aria-label="PyhDToolkit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PyhDToolkit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fsoubelet/PyhDToolkit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyhDToolkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/About_PyhDToolkit/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/Getting_Started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Pyhdtoolkit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pyhdtoolkit" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Pyhdtoolkit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_2" type="checkbox" id="__nav_4_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_2">
          Cpymadtools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cpymadtools" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_2">
          <span class="md-nav__icon md-icon"></span>
          Cpymadtools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../correctors/" class="md-nav__link">
        Correctors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../coupling/" class="md-nav__link">
        Coupling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../generators/" class="md-nav__link">
        Generators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lhc/" class="md-nav__link">
        Lhc
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Matching
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Matching
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_closest_tune_approach" class="md-nav__link">
    get_closest_tune_approach
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_lhc_tune_and_chroma_knobs" class="md-nav__link">
    get_lhc_tune_and_chroma_knobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match_tunes_and_chromaticities" class="md-nav__link">
    match_tunes_and_chromaticities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../orbit/" class="md-nav__link">
        Orbit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../parameters/" class="md-nav__link">
        Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plotters/" class="md-nav__link">
        Plotters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ptc/" class="md-nav__link">
        Ptc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../track/" class="md-nav__link">
        Track
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tune/" class="md-nav__link">
        Tune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../twiss/" class="md-nav__link">
        Twiss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_3" type="checkbox" id="__nav_4_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_3">
          Maths
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Maths" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_3">
          <span class="md-nav__icon md-icon"></span>
          Maths
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../maths/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../maths/nonconvex_phase_sync/" class="md-nav__link">
        Nonconvex Phase Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../maths/stats_fitting/" class="md-nav__link">
        Stats Fitting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../maths/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_4" type="checkbox" id="__nav_4_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_4">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_4">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/beam/" class="md-nav__link">
        Beam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/htc/" class="md-nav__link">
        Htc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/madx/" class="md-nav__link">
        Madx
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_5" type="checkbox" id="__nav_4_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_5">
          Optics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optics" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_5">
          <span class="md-nav__icon md-icon"></span>
          Optics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optics/beam/" class="md-nav__link">
        Beam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optics/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optics/ripken/" class="md-nav__link">
        Ripken
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optics/twiss/" class="md-nav__link">
        Twiss
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_6" type="checkbox" id="__nav_4_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_6">
          Plotting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plotting" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_6">
          <span class="md-nav__icon md-icon"></span>
          Plotting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_7" type="checkbox" id="__nav_4_1_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_7">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_7">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/cmdline/" class="md-nav__link">
        Cmdline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/contexts/" class="md-nav__link">
        Contexts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/defaults/" class="md-nav__link">
        Defaults
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/executors/" class="md-nav__link">
        Executors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/htc_monitor/" class="md-nav__link">
        Htc Monitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/operations/" class="md-nav__link">
        Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/printutil/" class="md-nav__link">
        Printutil
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_closest_tune_approach" class="md-nav__link">
    get_closest_tune_approach
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_lhc_tune_and_chroma_knobs" class="md-nav__link">
    get_lhc_tune_and_chroma_knobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match_tunes_and_chromaticities" class="md-nav__link">
    match_tunes_and_chromaticities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fsoubelet/PyhDToolkit/edit/main/reference/pyhdtoolkit/cpymadtools/matching.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="module-pyhdtoolkitcpymadtoolsmatching">Module pyhdtoolkit.cpymadtools.matching</h1>
<p>Module cpymadtools.matching</p>
<hr />
<p>Created on 2020.02.03</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Module cpymadtools.matching</span>

<span class="sd">---------------------------</span>

<span class="sd">Created on 2020.02.03</span>

<span class="sd">:author: Felix Soubelet (felix.soubelet@cern.ch)</span>

<span class="sd">A module with functions to perform MAD-X matchings with a cpymad.madx.Madx object.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">cpymad.madx</span> <span class="kn">import</span> <span class="n">Madx</span>

<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span> <span class="nn">pyhdtoolkit.utils</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="c1"># ----- Utlites ----- #</span>

<span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Please use its equivalent from the &#39;cpymadtools.lhc&#39; module.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span>

    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">beam</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    INITIAL IMPLEMENTATION CREDITS GO TO JOSCHUA DILLY (@JoschD).</span>

<span class="sd">    Get names of knobs needed to match tunes and chromaticities as a tuple of strings.</span>

<span class="sd">    Args:</span>

<span class="sd">        accelerator (str): Accelerator either &#39;LHC&#39; (dQ[xy], dQp[xy] knobs) or &#39;HLLHC&#39;</span>

<span class="sd">            (kqt[fd], ks[fd] knobs).</span>

<span class="sd">        beam (int): Beam to use, for the knob names.</span>

<span class="sd">        telescopic_squeeze (bool): if set to True, returns the knobs for Telescopic Squeeze configuration.</span>

<span class="sd">            Defaults to `True`.</span>

<span class="sd">    Returns:</span>

<span class="sd">        Tuple of strings with knobs for `(qx, qy, dqx, dqy)`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beam</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">beam</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">beam</span>

    <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;_sq&quot;</span> <span class="k">if</span> <span class="n">telescopic_squeeze</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">accelerator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;LHC&quot;</span><span class="p">,</span> <span class="s2">&quot;HLLHC&quot;</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid accelerator name, only &#39;LHC&#39; and &#39;HLLHC&#39; implemented&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accelerator &#39;</span><span class="si">{</span><span class="n">accelerator</span><span class="si">}</span><span class="s2">&#39; not implemented.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>

        <span class="s2">&quot;LHC&quot;</span><span class="p">:</span> <span class="p">(</span>

            <span class="sa">f</span><span class="s2">&quot;dQx.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;dQy.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;dQpx.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;dQpy.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

        <span class="p">),</span>

        <span class="s2">&quot;HLLHC&quot;</span><span class="p">:</span> <span class="p">(</span>

            <span class="sa">f</span><span class="s2">&quot;kqtf.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;kqtd.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;ksf.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="sa">f</span><span class="s2">&quot;ksd.b</span><span class="si">{</span><span class="n">beam</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

        <span class="p">),</span>

    <span class="p">}[</span><span class="n">accelerator</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

<span class="k">def</span> <span class="nf">match_tunes_and_chromaticities</span><span class="p">(</span>

    <span class="n">madx</span><span class="p">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">q1_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">q2_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">dq1_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">dq2_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">varied_knobs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span>

    <span class="n">calls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-21</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active `cpymad` instance, will run relevant commands to match tunes and/or chromaticities.</span>

<span class="sd">    As target values are given, the function expects knob names to be provided, which are then used and varied</span>

<span class="sd">    by `MAD-X` to match the targets.</span>

<span class="sd">    If target tune values only are provided, then tune matching is performed with the provided knobs. If target</span>

<span class="sd">    chromaticity values are provided, then chromaticity matching is performed with the provided knobs. If targets</span>

<span class="sd">    for both types are provided, then both are matched in a single call with the provided knobs. If the user wishes</span>

<span class="sd">    to perform different matching calls for each, then it is recommended to call this function as many times as</span>

<span class="sd">    necessary, with the appropriate targets.</span>

<span class="sd">    For instance, in some cases and machines some prefer to do a tune matching followed by a chromaticity matching,</span>

<span class="sd">    then followed by a combined matching. In this case the function should be called three times, once with tune</span>

<span class="sd">    targets and knobs, another time with chromaticity targets and knobs, then a final time with all of the above.</span>

<span class="sd">    When acting of either the `LHC` or `HLLHC`, the accelerator name can be provided and the vary knobs will be</span>

<span class="sd">    automatically set accordingly to the provided targets. Note that only the relevant knobs are set, so if tune</span>

<span class="sd">    targets only are provided, then tune knobs only will be used, and not chromaticity knobs. If explicit knobs</span>

<span class="sd">    are provided, these will always be used. On other machines the knobs should be provided explicitly, always.</span>

<span class="sd">    NOTA BENE: The matching is always performed with the `CHROM` option on.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        accelerator (str): name of the accelerator, used to determmine knobs if &#39;variables&#39; not given.</span>

<span class="sd">            Automatic determination will only work for `LHC` and `HLLHC`.</span>

<span class="sd">        sequence (str): name of the sequence you want to perform the matching for.</span>

<span class="sd">        q1_target (float): horizontal tune to match to.</span>

<span class="sd">        q2_target (float): vertical tune to match to.</span>

<span class="sd">        dq1_target (float): horizontal chromaticity to match to.</span>

<span class="sd">        dq2_target (float): vertical chromaticity to match to.</span>

<span class="sd">        varied_knobs (Sequence[str]): the variables names to &#39;vary&#39; in the `MAD-X` routine. An input</span>

<span class="sd">            could be [&quot;kqf&quot;, &quot;ksd&quot;, &quot;kqf&quot;, &quot;kqd&quot;] as they are common names used for quadrupole and</span>

<span class="sd">            sextupole strengths (focusing / defocusing) in most examples.</span>

<span class="sd">        telescopic_squeeze (bool): `LHC` specific. If set to `True`, uses the `(HL)LHC` knobs for Telescopic</span>

<span class="sd">            Squeeze configuration. Defaults to `True` as of Run III.</span>

<span class="sd">        step (float): step size to use when varying knobs.</span>

<span class="sd">        calls (int): max number of varying calls to perform.</span>

<span class="sd">        tolerance (float): tolerance for successfull matching.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">accelerator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">varied_knobs</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting knobs from default </span><span class="si">{</span><span class="n">accelerator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> values&quot;</span><span class="p">)</span>

        <span class="n">lhc_knobs</span> <span class="o">=</span> <span class="n">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span>

            <span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span> <span class="n">beam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">telescopic_squeeze</span><span class="o">=</span><span class="n">telescopic_squeeze</span>

        <span class="p">)</span>

        <span class="n">tune_knobs</span><span class="p">,</span> <span class="n">chroma_knobs</span> <span class="o">=</span> <span class="n">lhc_knobs</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">lhc_knobs</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># first two, last two</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create matching commands for kwarg targets, varying the given args.&quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing matching commands, using sequence &#39;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Targets are given as </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">global_</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating vary command for knob &#39;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">vary</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">lmdif</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">endmatch</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Performing routine TWISS&quot;</span><span class="p">)</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># prevents errors if the user forgets to TWISS before querying tables</span>

    <span class="k">if</span> <span class="n">q1_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q2_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dq1_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dq2_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>

            <span class="sa">f</span><span class="s2">&quot;Doing combined matching to Qx=</span><span class="si">{</span><span class="n">q1_target</span><span class="si">}</span><span class="s2">, Qy=</span><span class="si">{</span><span class="n">q2_target</span><span class="si">}</span><span class="s2">, &quot;</span>

            <span class="sa">f</span><span class="s2">&quot;dqx=</span><span class="si">{</span><span class="n">dq1_target</span><span class="si">}</span><span class="s2">, dqy=</span><span class="si">{</span><span class="n">dq2_target</span><span class="si">}</span><span class="s2"> for sequence &#39;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="p">)</span>

        <span class="n">varied_knobs</span> <span class="o">=</span> <span class="n">varied_knobs</span> <span class="ow">or</span> <span class="n">lhc_knobs</span>  <span class="c1"># if accelerator was given we&#39;ve extracted this already</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vary knobs sent are </span><span class="si">{</span><span class="n">varied_knobs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">varied_knobs</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="n">q1_target</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="n">q2_target</span><span class="p">,</span> <span class="n">dq1</span><span class="o">=</span><span class="n">dq1_target</span><span class="p">,</span> <span class="n">dq2</span><span class="o">=</span><span class="n">dq2_target</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">q1_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q2_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matching tunes to Qx=</span><span class="si">{</span><span class="n">q1_target</span><span class="si">}</span><span class="s2">, Qy=</span><span class="si">{</span><span class="n">q2_target</span><span class="si">}</span><span class="s2"> for sequence &#39;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">tune_knobs</span> <span class="o">=</span> <span class="n">varied_knobs</span> <span class="ow">or</span> <span class="n">tune_knobs</span>  <span class="c1"># if accelerator was given we&#39;ve extracted this already</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vary knobs sent are </span><span class="si">{</span><span class="n">tune_knobs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">tune_knobs</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="n">q1_target</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="n">q2_target</span><span class="p">)</span>  <span class="c1"># sent varied_knobs should be tune knobs</span>

    <span class="k">elif</span> <span class="n">dq1_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dq2_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matching chromaticities to dq1=</span><span class="si">{</span><span class="n">dq1_target</span><span class="si">}</span><span class="s2">, dq2=</span><span class="si">{</span><span class="n">dq2_target</span><span class="si">}</span><span class="s2"> for sequence </span><span class="si">{</span><span class="n">sequence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">chroma_knobs</span> <span class="o">=</span> <span class="n">varied_knobs</span> <span class="ow">or</span> <span class="n">chroma_knobs</span>  <span class="c1"># if accelerator was given we&#39;ve extracted this already</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vary knobs sent are </span><span class="si">{</span><span class="n">chroma_knobs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">chroma_knobs</span><span class="p">,</span> <span class="n">dq1</span><span class="o">=</span><span class="n">dq1_target</span><span class="p">,</span> <span class="n">dq2</span><span class="o">=</span><span class="n">dq2_target</span><span class="p">)</span>  <span class="c1"># sent varied_knobs should be chromaticity knobs</span>

<span class="c1"># TODO: DO NOT TARGET CHROMATICITIES IN THIS, WITH CHROM THAT COUPLES IT THE ALGORITHM WILL BE CONFUSED</span>

<span class="c1"># In turn one won&#39;t get to the CTA when they actually could, shame.</span>

<span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Please use its equivalent from the &#39;cpymadtools.coupling&#39; module.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_closest_tune_approach</span><span class="p">(</span>

    <span class="n">madx</span><span class="p">:</span> <span class="n">Madx</span><span class="p">,</span>

    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">varied_knobs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="n">explicit_targets</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

    <span class="n">step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span>

    <span class="n">calls</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-21</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active `cpymad` instance, tries to match the tunes to their mid-fractional tunes,</span>

<span class="sd">    aka getting them together. The difference between the final reached fractional tunes is the closest</span>

<span class="sd">    tune approach. This should not have any effect on the user&#39;s simulation, as the varied knobs are</span>

<span class="sd">    restored to their previous values after performing the CTA.</span>

<span class="sd">    NOTA BENE: This assumes the sequence has previously been matched to the user&#39;s desired working point,</span>

<span class="sd">    as if not explicitely given, the appropriate targets will be determined from `MAD-X`&#39;s internal tables.</span>

<span class="sd">    NOTA BENE: This is hard-coded to use the `CHROM` flag when performing matching, since we expect to be in</span>

<span class="sd">    the presence of betatron coupling. In this case, attempting to match chromaticities at the same time as the</span>

<span class="sd">    tunes might cause `LMDIF` to fail, as the knobs become dependent. For this reason, only tune matching is</span>

<span class="sd">    performed here, and chromaticities are voluntarily ignored.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        accelerator (str): name of the accelerator, used to determmine knobs if &#39;variables&#39; not given.</span>

<span class="sd">            Automatic determination will only work for LHC and HLLHC.</span>

<span class="sd">        sequence (str): name of the sequence you want to activate for the tune matching.</span>

<span class="sd">        varied_knobs (Sequence[str]): the variables names to &#39;vary&#39; in the MADX routine. An input</span>

<span class="sd">            could be [&quot;kqf&quot;, &quot;ksd&quot;, &quot;kqf&quot;, &quot;kqd&quot;] as they are common names used for quadrupole and</span>

<span class="sd">            sextupole strengths (foc / defoc) in most examples.</span>

<span class="sd">        telescopic_squeeze (bool): LHC specific. If set to True, uses the (HL)LHC knobs for Telescopic</span>

<span class="sd">            Squeeze configuration. Defaults to `True`.</span>

<span class="sd">        explicit_targets (Tuple[float, float]): if given, will be used as matching targets for Qx, Qy.</span>

<span class="sd">            Otherwise, the target is determined as the middle of the current fractional tunes. Defaults to</span>

<span class="sd">            None.</span>

<span class="sd">        step (float): step size to use when varying knobs.</span>

<span class="sd">        calls (int): max number of varying calls to perform.</span>

<span class="sd">        tolerance (float): tolerance for successfull matching.</span>

<span class="sd">    Returns:</span>

<span class="sd">        The closest tune approach, in absolute value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">accelerator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">varied_knobs</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting knobs from default </span><span class="si">{</span><span class="n">accelerator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> values&quot;</span><span class="p">)</span>

        <span class="n">varied_knobs</span> <span class="o">=</span> <span class="n">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span>

            <span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span> <span class="n">beam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">telescopic_squeeze</span><span class="o">=</span><span class="n">telescopic_squeeze</span>

        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Running TWISS to update SUMM and TWISS tables&quot;</span><span class="p">)</span>

    <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving knob values to restore after closest tune approach&quot;</span><span class="p">)</span>

    <span class="n">saved_knobs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">knob</span><span class="p">:</span> <span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="n">knob</span><span class="p">]</span> <span class="k">for</span> <span class="n">knob</span> <span class="ow">in</span> <span class="n">varied_knobs</span><span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved knobs are </span><span class="si">{</span><span class="n">saved_knobs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">explicit_targets</span><span class="p">:</span>

        <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">explicit_targets</span>  <span class="c1"># the integer part is used later on</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Retrieving tunes and chromaticities from internal tables&quot;</span><span class="p">)</span>

        <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved values are q1 = </span><span class="si">{</span><span class="n">q1</span><span class="si">}</span><span class="s2">, q2 = </span><span class="si">{</span><span class="n">q2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Determining target tunes for closest approach&quot;</span><span class="p">)</span>

    <span class="n">middle_of_fractional_tunes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_fractional_tune</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">_fractional_tune</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">qx_target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">middle_of_fractional_tunes</span>

    <span class="n">qy_target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">middle_of_fractional_tunes</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Targeting tunes Qx = </span><span class="si">{</span><span class="n">qx_target</span><span class="si">}</span><span class="s2">  |  Qy = </span><span class="si">{</span><span class="n">qy_target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing closest tune approach routine, matching should fail at DeltaQ = dqmin&quot;</span><span class="p">)</span>

    <span class="n">match_tunes_and_chromaticities</span><span class="p">(</span>

        <span class="n">madx</span><span class="p">,</span>

        <span class="n">accelerator</span><span class="p">,</span>

        <span class="n">sequence</span><span class="p">,</span>

        <span class="n">q1_target</span><span class="o">=</span><span class="n">qx_target</span><span class="p">,</span>

        <span class="n">q2_target</span><span class="o">=</span><span class="n">qy_target</span><span class="p">,</span>

        <span class="n">varied_knobs</span><span class="o">=</span><span class="n">varied_knobs</span><span class="p">,</span>

        <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>

        <span class="n">calls</span><span class="o">=</span><span class="n">calls</span><span class="p">,</span>

        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>

    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrieving tune separation from internal tables&quot;</span><span class="p">)</span>

    <span class="n">dqmin</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span>

    <span class="n">cminus</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dqmin</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matching got to a Closest Tune Approach of </span><span class="si">{</span><span class="n">cminus</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring saved knobs&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">madx</span><span class="o">.</span><span class="n">batch</span><span class="p">():</span>

        <span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">saved_knobs</span><span class="p">)</span>

    <span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make sure TWISS and SUMM tables are returned to their original state</span>

    <span class="k">return</span> <span class="n">cminus</span>

<span class="c1"># ----- Helpers ----- #</span>

<span class="c1"># TODO: remove this once deprecated &#39;get_closest_tune_approach&#39; is removed as its the only thing using it</span>

<span class="k">def</span> <span class="nf">_fractional_tune</span><span class="p">(</span><span class="n">tune</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Return only the fractional part of a tune value.</span>

<span class="sd">    Args:</span>

<span class="sd">        tune (float): tune value.</span>

<span class="sd">    Returns:</span>

<span class="sd">        The fractional part.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">tune</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">tune</span><span class="p">)</span>  <span class="c1"># ok since int truncates to lower integer</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="get_closest_tune_approach">get_closest_tune_approach</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_closest_tune_approach</span><span class="p">(</span>
    <span class="n">madx</span><span class="p">:</span> <span class="n">cpymad</span><span class="o">.</span><span class="n">madx</span><span class="o">.</span><span class="n">Madx</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">varied_knobs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">explicit_targets</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-07</span><span class="p">,</span>
    <span class="n">calls</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-21</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>
<p>Provided with an active <code>cpymad</code> instance, tries to match the tunes to their mid-fractional tunes,</p>
<p>aka getting them together. The difference between the final reached fractional tunes is the closest
tune approach. This should not have any effect on the user's simulation, as the varied knobs are
restored to their previous values after performing the CTA.</p>
<p>NOTA BENE: This assumes the sequence has previously been matched to the user's desired working point,
as if not explicitely given, the appropriate targets will be determined from <code>MAD-X</code>'s internal tables.</p>
<p>NOTA BENE: This is hard-coded to use the <code>CHROM</code> flag when performing matching, since we expect to be in
the presence of betatron coupling. In this case, attempting to match chromaticities at the same time as the
tunes might cause <code>LMDIF</code> to fail, as the knobs become dependent. For this reason, only tune matching is
performed here, and chromaticities are voluntarily ignored.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>madx</td>
<td>cpymad.madx.Madx</td>
<td>an instanciated cpymad Madx object.</td>
<td>None</td>
</tr>
<tr>
<td>accelerator</td>
<td>str</td>
<td>name of the accelerator, used to determmine knobs if 'variables' not given.</td>
<td></td>
</tr>
<tr>
<td>Automatic determination will only work for LHC and HLLHC.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>sequence</td>
<td>str</td>
<td>name of the sequence you want to activate for the tune matching.</td>
<td>None</td>
</tr>
<tr>
<td>varied_knobs</td>
<td>Sequence[str]</td>
<td>the variables names to 'vary' in the MADX routine. An input</td>
<td></td>
</tr>
<tr>
<td>could be ["kqf", "ksd", "kqf", "kqd"] as they are common names used for quadrupole and</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sextupole strengths (foc / defoc) in most examples.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>telescopic_squeeze</td>
<td>bool</td>
<td>LHC specific. If set to True, uses the (HL)LHC knobs for Telescopic</td>
<td></td>
</tr>
<tr>
<td>Squeeze configuration. Defaults to <code>True</code>.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>explicit_targets</td>
<td>Tuple[float, float]</td>
<td>if given, will be used as matching targets for Qx, Qy.</td>
<td></td>
</tr>
<tr>
<td>Otherwise, the target is determined as the middle of the current fractional tunes. Defaults to</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>None.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>step</td>
<td>float</td>
<td>step size to use when varying knobs.</td>
<td>None</td>
</tr>
<tr>
<td>calls</td>
<td>int</td>
<td>max number of varying calls to perform.</td>
<td>None</td>
</tr>
<tr>
<td>tolerance</td>
<td>float</td>
<td>tolerance for successfull matching.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>The closest tune approach, in absolute value.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Please use its equivalent from the &#39;cpymadtools.coupling&#39; module.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">get_closest_tune_approach</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="n">madx</span><span class="p">:</span><span class="w"> </span><span class="n">Madx</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">accelerator</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">sequence</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">varied_knobs</span><span class="p">:</span><span class="w"> </span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">telescopic_squeeze</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">explicit_targets</span><span class="p">:</span><span class="w"> </span><span class="n">Tuple</span><span class="p">[</span><span class="nb nb-Type">float</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">step</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-7</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">calls</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">tolerance</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-21</span><span class="p">,</span><span class="w"></span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Provided with an active `cpymad` instance, tries to match the tunes to their mid-fractional tunes,</span>

<span class="sd">    aka getting them together. The difference between the final reached fractional tunes is the closest</span>

<span class="sd">    tune approach. This should not have any effect on the user&#39;s simulation, as the varied knobs are</span>

<span class="sd">    restored to their previous values after performing the CTA.</span>

<span class="sd">    NOTA BENE: This assumes the sequence has previously been matched to the user&#39;s desired working point,</span>

<span class="sd">    as if not explicitely given, the appropriate targets will be determined from `MAD-X`&#39;s internal tables.</span>

<span class="sd">    NOTA BENE: This is hard-coded to use the `CHROM` flag when performing matching, since we expect to be in</span>

<span class="sd">    the presence of betatron coupling. In this case, attempting to match chromaticities at the same time as the</span>

<span class="sd">    tunes might cause `LMDIF` to fail, as the knobs become dependent. For this reason, only tune matching is</span>

<span class="sd">    performed here, and chromaticities are voluntarily ignored.</span>

<span class="sd">    Args:</span>

<span class="sd">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="sd">        accelerator (str): name of the accelerator, used to determmine knobs if &#39;variables&#39; not given.</span>

<span class="sd">            Automatic determination will only work for LHC and HLLHC.</span>

<span class="sd">        sequence (str): name of the sequence you want to activate for the tune matching.</span>

<span class="sd">        varied_knobs (Sequence[str]): the variables names to &#39;vary&#39; in the MADX routine. An input</span>

<span class="sd">            could be [&quot;kqf&quot;, &quot;ksd&quot;, &quot;kqf&quot;, &quot;kqd&quot;] as they are common names used for quadrupole and</span>

<span class="sd">            sextupole strengths (foc / defoc) in most examples.</span>

<span class="sd">        telescopic_squeeze (bool): LHC specific. If set to True, uses the (HL)LHC knobs for Telescopic</span>

<span class="sd">            Squeeze configuration. Defaults to `True`.</span>

<span class="sd">        explicit_targets (Tuple[float, float]): if given, will be used as matching targets for Qx, Qy.</span>

<span class="sd">            Otherwise, the target is determined as the middle of the current fractional tunes. Defaults to</span>

<span class="sd">            None.</span>

<span class="sd">        step (float): step size to use when varying knobs.</span>

<span class="sd">        calls (int): max number of varying calls to perform.</span>

<span class="sd">        tolerance (float): tolerance for successfull matching.</span>

<span class="sd">    Returns:</span>

<span class="sd">        The closest tune approach, in absolute value.</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">accelerator</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">varied_knobs</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Getting knobs from default {accelerator.upper()} values&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">varied_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span><span class="w"> </span><span class="n">beam</span><span class="o">=</span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="n">telescopic_squeeze</span><span class="o">=</span><span class="n">telescopic_squeeze</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Running TWISS to update SUMM and TWISS tables&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="n">True</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving knob values to restore after closest tune approach&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">saved_knobs</span><span class="p">:</span><span class="w"> </span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">knob</span><span class="p">:</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="n">knob</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">knob</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">varied_knobs</span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Saved knobs are {saved_knobs}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">explicit_targets</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">q1</span><span class="p">,</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_targets</span><span class="w">  </span><span class="c1"># the integer part is used later on</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Retrieving tunes and chromaticities from internal tables&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">q1</span><span class="p">,</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Retrieved values are q1 = {q1}, q2 = {q2}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Determining target tunes for closest approach&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">middle_of_fractional_tunes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_fractional_tune</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_fractional_tune</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="n">qx_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">middle_of_fractional_tunes</span><span class="w"></span>

<span class="w">    </span><span class="n">qy_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">middle_of_fractional_tunes</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Targeting tunes Qx = {qx_target}  |  Qy = {qy_target}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing closest tune approach routine, matching should fail at DeltaQ = dqmin&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">match_tunes_and_chromaticities</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">accelerator</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">sequence</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">q1_target</span><span class="o">=</span><span class="n">qx_target</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">q2_target</span><span class="o">=</span><span class="n">qy_target</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">varied_knobs</span><span class="o">=</span><span class="n">varied_knobs</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">calls</span><span class="o">=</span><span class="n">calls</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrieving tune separation from internal tables&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">dqmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">cminus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">dqmin</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Matching got to a Closest Tune Approach of {cminus:.5f}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring saved knobs&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">with</span><span class="w"> </span><span class="n">madx</span><span class="o">.</span><span class="n">batch</span><span class="p">():</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">saved_knobs</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="n">True</span><span class="p">)</span><span class="w">  </span><span class="c1"># make sure TWISS and SUMM tables are returned to their original state</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cminus</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="get_lhc_tune_and_chroma_knobs">get_lhc_tune_and_chroma_knobs</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span>
    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">beam</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>
<p>INITIAL IMPLEMENTATION CREDITS GO TO JOSCHUA DILLY (@JoschD).</p>
<p>Get names of knobs needed to match tunes and chromaticities as a tuple of strings.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>accelerator</td>
<td>str</td>
<td>Accelerator either 'LHC' (dQ[xy], dQp[xy] knobs) or 'HLLHC'</td>
<td></td>
</tr>
<tr>
<td>(kqt[fd], ks[fd] knobs).</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>beam</td>
<td>int</td>
<td>Beam to use, for the knob names.</td>
<td>None</td>
</tr>
<tr>
<td>telescopic_squeeze</td>
<td>bool</td>
<td>if set to True, returns the knobs for Telescopic Squeeze configuration.</td>
<td></td>
</tr>
<tr>
<td>Defaults to <code>True</code>.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>Tuple of strings with knobs for <code>(qx, qy, dqx, dqy)</code>.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nv">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="ss">&quot;Please use its equivalent from the &#39;cpymadtools.lhc&#39; module.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="nl">accelerator</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">beam</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">telescopic_squeeze</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Tuple</span><span class="o">[</span><span class="n">str, str, str, str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    INITIAL IMPLEMENTATION CREDITS GO TO JOSCHUA DILLY (@JoschD).</span>

<span class="ss">    Get names of knobs needed to match tunes and chromaticities as a tuple of strings.</span>

<span class="ss">    Args:</span>

<span class="ss">        accelerator (str): Accelerator either &#39;LHC&#39; (dQ[xy], dQp[xy] knobs) or &#39;HLLHC&#39;</span>

<span class="ss">            (kqt[fd], ks[fd] knobs).</span>

<span class="ss">        beam (int): Beam to use, for the knob names.</span>

<span class="ss">        telescopic_squeeze (bool): if set to True, returns the knobs for Telescopic Squeeze configuration.</span>

<span class="ss">            Defaults to `True`.</span>

<span class="ss">    Returns:</span>

<span class="ss">        Tuple of strings with knobs for `(qx, qy, dqx, dqy)`.</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">beam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">beam</span><span class="w"></span>

<span class="w">    </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;_sq&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">telescopic_squeeze</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">accelerator</span><span class="p">.</span><span class="nf">upper</span><span class="p">()</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;LHC&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;HLLHC&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;Invalid accelerator name, only &#39;LHC&#39; and &#39;HLLHC&#39; implemented&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">NotImplementedError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Accelerator &#39;{accelerator}&#39; not implemented.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;LHC&quot;</span><span class="err">:</span><span class="w"> </span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;dQx.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;dQy.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;dQpx.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;dQpy.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;HLLHC&quot;</span><span class="err">:</span><span class="w"> </span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;kqtf.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;kqtd.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;ksf.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;ksd.b{beam}{suffix}&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="err">}</span><span class="o">[</span><span class="n">accelerator.upper()</span><span class="o">]</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="match_tunes_and_chromaticities">match_tunes_and_chromaticities</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">match_tunes_and_chromaticities</span><span class="p">(</span>
    <span class="n">madx</span><span class="p">:</span> <span class="n">cpymad</span><span class="o">.</span><span class="n">madx</span><span class="o">.</span><span class="n">Madx</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">q1_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">q2_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dq1_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dq2_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">varied_knobs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">telescopic_squeeze</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-07</span><span class="p">,</span>
    <span class="n">calls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-21</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>
<p>Provided with an active <code>cpymad</code> instance, will run relevant commands to match tunes and/or chromaticities.</p>
<p>As target values are given, the function expects knob names to be provided, which are then used and varied
by <code>MAD-X</code> to match the targets.</p>
<p>If target tune values only are provided, then tune matching is performed with the provided knobs. If target
chromaticity values are provided, then chromaticity matching is performed with the provided knobs. If targets
for both types are provided, then both are matched in a single call with the provided knobs. If the user wishes
to perform different matching calls for each, then it is recommended to call this function as many times as
necessary, with the appropriate targets.</p>
<p>For instance, in some cases and machines some prefer to do a tune matching followed by a chromaticity matching,
then followed by a combined matching. In this case the function should be called three times, once with tune
targets and knobs, another time with chromaticity targets and knobs, then a final time with all of the above.</p>
<p>When acting of either the <code>LHC</code> or <code>HLLHC</code>, the accelerator name can be provided and the vary knobs will be
automatically set accordingly to the provided targets. Note that only the relevant knobs are set, so if tune
targets only are provided, then tune knobs only will be used, and not chromaticity knobs. If explicit knobs
are provided, these will always be used. On other machines the knobs should be provided explicitly, always.</p>
<p>NOTA BENE: The matching is always performed with the <code>CHROM</code> option on.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>madx</td>
<td>cpymad.madx.Madx</td>
<td>an instanciated cpymad Madx object.</td>
<td>None</td>
</tr>
<tr>
<td>accelerator</td>
<td>str</td>
<td>name of the accelerator, used to determmine knobs if 'variables' not given.</td>
<td></td>
</tr>
<tr>
<td>Automatic determination will only work for <code>LHC</code> and <code>HLLHC</code>.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>sequence</td>
<td>str</td>
<td>name of the sequence you want to perform the matching for.</td>
<td>None</td>
</tr>
<tr>
<td>q1_target</td>
<td>float</td>
<td>horizontal tune to match to.</td>
<td>None</td>
</tr>
<tr>
<td>q2_target</td>
<td>float</td>
<td>vertical tune to match to.</td>
<td>None</td>
</tr>
<tr>
<td>dq1_target</td>
<td>float</td>
<td>horizontal chromaticity to match to.</td>
<td>None</td>
</tr>
<tr>
<td>dq2_target</td>
<td>float</td>
<td>vertical chromaticity to match to.</td>
<td>None</td>
</tr>
<tr>
<td>varied_knobs</td>
<td>Sequence[str]</td>
<td>the variables names to 'vary' in the <code>MAD-X</code> routine. An input</td>
<td></td>
</tr>
<tr>
<td>could be ["kqf", "ksd", "kqf", "kqd"] as they are common names used for quadrupole and</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sextupole strengths (focusing / defocusing) in most examples.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>telescopic_squeeze</td>
<td>bool</td>
<td><code>LHC</code> specific. If set to <code>True</code>, uses the <code>(HL)LHC</code> knobs for Telescopic</td>
<td></td>
</tr>
<tr>
<td>Squeeze configuration. Defaults to <code>True</code> as of Run III.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>step</td>
<td>float</td>
<td>step size to use when varying knobs.</td>
<td>None</td>
</tr>
<tr>
<td>calls</td>
<td>int</td>
<td>max number of varying calls to perform.</td>
<td>None</td>
</tr>
<tr>
<td>tolerance</td>
<td>float</td>
<td>tolerance for successfull matching.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">match_tunes_and_chromaticities</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="n">madx</span><span class="o">:</span><span class="w"> </span><span class="n">Madx</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">accelerator</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">sequence</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">q1_target</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">q2_target</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">dq1_target</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">dq2_target</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">varied_knobs</span><span class="o">:</span><span class="w"> </span><span class="n">Sequence</span><span class="err">[</span><span class="n">str</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">telescopic_squeeze</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">step</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-7</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">calls</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">tolerance</span><span class="o">:</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-21</span><span class="p">,</span><span class="w"></span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2"></span>

<span class="s2">    Provided with an active `cpymad` instance, will run relevant commands to match tunes and/or chromaticities.</span>

<span class="s2">    As target values are given, the function expects knob names to be provided, which are then used and varied</span>

<span class="s2">    by `MAD-X` to match the targets.</span>

<span class="s2">    If target tune values only are provided, then tune matching is performed with the provided knobs. If target</span>

<span class="s2">    chromaticity values are provided, then chromaticity matching is performed with the provided knobs. If targets</span>

<span class="s2">    for both types are provided, then both are matched in a single call with the provided knobs. If the user wishes</span>

<span class="s2">    to perform different matching calls for each, then it is recommended to call this function as many times as</span>

<span class="s2">    necessary, with the appropriate targets.</span>

<span class="s2">    For instance, in some cases and machines some prefer to do a tune matching followed by a chromaticity matching,</span>

<span class="s2">    then followed by a combined matching. In this case the function should be called three times, once with tune</span>

<span class="s2">    targets and knobs, another time with chromaticity targets and knobs, then a final time with all of the above.</span>

<span class="s2">    When acting of either the `LHC` or `HLLHC`, the accelerator name can be provided and the vary knobs will be</span>

<span class="s2">    automatically set accordingly to the provided targets. Note that only the relevant knobs are set, so if tune</span>

<span class="s2">    targets only are provided, then tune knobs only will be used, and not chromaticity knobs. If explicit knobs</span>

<span class="s2">    are provided, these will always be used. On other machines the knobs should be provided explicitly, always.</span>

<span class="s2">    NOTA BENE: The matching is always performed with the `CHROM` option on.</span>

<span class="s2">    Args:</span>

<span class="s2">        madx (cpymad.madx.Madx): an instanciated cpymad Madx object.</span>

<span class="s2">        accelerator (str): name of the accelerator, used to determmine knobs if &#39;variables&#39; not given.</span>

<span class="s2">            Automatic determination will only work for `LHC` and `HLLHC`.</span>

<span class="s2">        sequence (str): name of the sequence you want to perform the matching for.</span>

<span class="s2">        q1_target (float): horizontal tune to match to.</span>

<span class="s2">        q2_target (float): vertical tune to match to.</span>

<span class="s2">        dq1_target (float): horizontal chromaticity to match to.</span>

<span class="s2">        dq2_target (float): vertical chromaticity to match to.</span>

<span class="s2">        varied_knobs (Sequence[str]): the variables names to &#39;vary&#39; in the `MAD-X` routine. An input</span>

<span class="s2">            could be [&quot;</span><span class="n">kqf</span><span class="s2">&quot;, &quot;</span><span class="n">ksd</span><span class="s2">&quot;, &quot;</span><span class="n">kqf</span><span class="s2">&quot;, &quot;</span><span class="n">kqd</span><span class="s2">&quot;] as they are common names used for quadrupole and</span>

<span class="s2">            sextupole strengths (focusing / defocusing) in most examples.</span>

<span class="s2">        telescopic_squeeze (bool): `LHC` specific. If set to `True`, uses the `(HL)LHC` knobs for Telescopic</span>

<span class="s2">            Squeeze configuration. Defaults to `True` as of Run III.</span>

<span class="s2">        step (float): step size to use when varying knobs.</span>

<span class="s2">        calls (int): max number of varying calls to perform.</span>

<span class="s2">        tolerance (float): tolerance for successfull matching.</span>

<span class="s2">    </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">accelerator</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">varied_knobs</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Getting knobs from default {accelerator.upper()} values&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">lhc_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_lhc_tune_and_chroma_knobs</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span><span class="w"> </span><span class="n">beam</span><span class="o">=</span><span class="kt">int</span><span class="p">(</span><span class="n">sequence</span><span class="err">[</span><span class="o">-</span><span class="mi">1</span><span class="err">]</span><span class="p">),</span><span class="w"> </span><span class="n">telescopic_squeeze</span><span class="o">=</span><span class="n">telescopic_squeeze</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">tune_knobs</span><span class="p">,</span><span class="w"> </span><span class="n">chroma_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lhc_knobs</span><span class="err">[</span><span class="o">:</span><span class="mi">2</span><span class="err">]</span><span class="p">,</span><span class="w"> </span><span class="n">lhc_knobs</span><span class="err">[</span><span class="mi">2</span><span class="o">:</span><span class="err">]</span><span class="w">  </span><span class="c1"># first two, last two</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Create matching commands for kwarg targets, varying the given args.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Executing matching commands, using sequence &#39;{sequence}&#39;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="k">match</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="no">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Targets are given as {kwargs}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">global_</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">variable_name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">args</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Creating vary command for knob &#39;{variable_name}&#39;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">vary</span><span class="p">(</span><span class="k">name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">lmdif</span><span class="p">(</span><span class="n">calls</span><span class="o">=</span><span class="n">calls</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">endmatch</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Performing routine TWISS&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">madx</span><span class="p">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">chrom</span><span class="o">=</span><span class="no">True</span><span class="p">)</span><span class="w">  </span><span class="c1"># prevents errors if the user forgets to TWISS before querying tables</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">q1_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">q2_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">dq1_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">dq2_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;Doing combined matching to Qx={q1_target}, Qy={q2_target}, &quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;dqx={dq1_target}, dqy={dq2_target} for sequence &#39;{sequence}&#39;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">varied_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">varied_knobs</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">lhc_knobs</span><span class="w">  </span><span class="c1"># if accelerator was given we&#39;ve extracted this already</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vary knobs sent are {varied_knobs}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">varied_knobs</span><span class="p">,</span><span class="w"> </span><span class="n">q1</span><span class="o">=</span><span class="n">q1_target</span><span class="p">,</span><span class="w"> </span><span class="n">q2</span><span class="o">=</span><span class="n">q2_target</span><span class="p">,</span><span class="w"> </span><span class="n">dq1</span><span class="o">=</span><span class="n">dq1_target</span><span class="p">,</span><span class="w"> </span><span class="n">dq2</span><span class="o">=</span><span class="n">dq2_target</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">elif</span><span class="w"> </span><span class="n">q1_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">q2_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Matching tunes to Qx={q1_target}, Qy={q2_target} for sequence &#39;{sequence}&#39;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">tune_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">varied_knobs</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">tune_knobs</span><span class="w">  </span><span class="c1"># if accelerator was given we&#39;ve extracted this already</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vary knobs sent are {tune_knobs}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">tune_knobs</span><span class="p">,</span><span class="w"> </span><span class="n">q1</span><span class="o">=</span><span class="n">q1_target</span><span class="p">,</span><span class="w"> </span><span class="n">q2</span><span class="o">=</span><span class="n">q2_target</span><span class="p">)</span><span class="w">  </span><span class="c1"># sent varied_knobs should be tune knobs</span><span class="w"></span>

<span class="w">    </span><span class="n">elif</span><span class="w"> </span><span class="n">dq1_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">dq2_target</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Matching chromaticities to dq1={dq1_target}, dq2={dq2_target} for sequence {sequence}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">chroma_knobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">varied_knobs</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">chroma_knobs</span><span class="w">  </span><span class="c1"># if accelerator was given we&#39;ve extracted this already</span><span class="w"></span>

<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vary knobs sent are {chroma_knobs}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">match</span><span class="p">(</span><span class="o">*</span><span class="n">chroma_knobs</span><span class="p">,</span><span class="w"> </span><span class="n">dq1</span><span class="o">=</span><span class="n">dq1_target</span><span class="p">,</span><span class="w"> </span><span class="n">dq2</span><span class="o">=</span><span class="n">dq2_target</span><span class="p">)</span><span class="w">  </span><span class="c1"># sent varied_knobs should be chromaticity knobs</span><span class="w"></span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lhc/" title="Lhc" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Lhc
              </span>
            </div>
          </a>
        
        
          <a href="../orbit/" title="Orbit" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Orbit
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>